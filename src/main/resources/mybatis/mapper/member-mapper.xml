<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="member">
	
	<!-- 회원가입 -->
	<insert id="join">
		INSERT INTO MEMBER
		(
			NO
			,NAME
			,ID
			,PWD
			,BIRTH
			,HP
			,EMAIL
			,LOCATION_NO
			,GENDER_CODE
		)
		VALUES
		(
			SEQ_MEMBER_NO.NEXTVAL
			, #{name}
			, #{id}
			, #{pwd}
			, #{birth}
			, #{hp}
			, #{email}
			, #{locationNo}
			, #{genderCode}
		)
	</insert>
	
	<!-- 아이디 중복체크 -->
	<select id="checkId" resultType="int">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE ID = #{id}
	</select>

	<!-- 로그인 -->
	<select id="login" resultType="MemberVo">
		SELECT NO, NAME, ID, PWD, BIRTH, HP, EMAIL,QUIT_YN, LOCATION_NO, GENDER_CODE
		FROM MEMBER
		WHERE ID = #{id}
		AND PWD = #{pwd}
		AND QUIT_YN = 'N'
	</select>
	
	<!-- 나의 market feed -->
	<select id="marketFeed" resultType="MarketVo">
		SELECT 
	    K.MARKET_NO
		, K.WRITER
		, K.TITLE
		, K.CONTENT
		, K.PRICE
		, K.ENROLL_DATE
		, K.EDIT_DATE
		, K.DELETE_YN
		, K.LOCATION_NO
		, K.STATUS_YN
		, L.LOCATION_NAME as locationName
		, M.NAME as writerName
	FROM MARKET K
	LEFT JOIN LOCATION L ON (K.LOCATION_NO = L.LOCATION_NO)
	LEFT JOIN MEMBER M  ON (K.WRITER = M.NO)
	WHERE K.DELETE_YN = 'N'
	AND K.WRITER = #{writer}
	ORDER BY MARKET_NO DESC
	</select>
	
	<!-- 나의 friend feed -->
	<select id="friendFeed" resultType="FriendVo">
		SELECT
	    F.FRIEND_NO
	    , F.WRITER
	    , F.TITLE
	    , F.CONTENT
	    , F.ENROLL_DATE
	    , F.DELETE_YN
	    , F.EDIT_DATE
	    , F.LOCATION_NO 
	    , L.LOCATION_NAME as locationName
	    , M.NAME as writerName
	FROM FRIEND F
	LEFT JOIN LOCATION L ON (F.LOCATION_NO = L.LOCATION_NO)
	LEFT JOIN MEMBER M ON (F.WRITER = M.NO)
	WHERE F.DELETE_YN = 'N'
	AND F.WRITER = #{writer}
	ORDER BY F.FRIEND_NO DESC
	</select>
	
	<!-- 지역 리스트 -->
	<select id="getLocationList" resultType="map">
		SELECT
			LOCATION_NO
	  		, LOCATION_NAME
	  	FROM LOCATION
	</select>
	
	<!-- market feed 갯수 -->
	<select id="myMarketFeedCount" resultType="int">
		SELECT COUNT(MARKET_NO)
		FROM MARKET
		WHERE DELETE_YN = 'N'
		AND WRITER = #{writer}
	</select>
	
	<!-- friend feed 갯수 -->
	<select id="myFriendFeedCount" resultType="int">
		SELECT COUNT(FRIEND_NO)
		FROM FRIEND
		WHERE DELETE_YN = 'N'
		AND WRITER = #{writer}
	</select>

</mapper>