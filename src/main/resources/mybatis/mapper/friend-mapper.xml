<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="friend">
  
  <select id="FriendFeed" resultType="FriendVo">
	SELECT
	    F.FRIEND_NO
	    , F.WRITER
	    , F.TITLE
	    , F.CONTENT
	    , F.ENROLL_DATE
	    , F.DELETE_YN
	    , F.EDIT_DATE
	    , F.LOCATION_NO 
	    , L.LOCATION_NAME as locationName
	    , M.NAME as writerName
	FROM FRIEND F
	LEFT JOIN LOCATION L ON (F.LOCATION_NO = L.LOCATION_NO)
	LEFT JOIN MEMBER M ON (F.WRITER = M.NO)
	WHERE F.DELETE_YN = 'N'
		<if test="searchType == 'title'">
			AND F.TITLE LIKE '%${searchValue}%'
		</if>
		<if test="searchType == 'content'">
			AND F.CONTENT LIKE '%${searchValue}%'
		</if>
	
  </select>
  
  <insert id="write">
	INSERT INTO FRIEND
 	(
 		FRIEND_NO
 		, WRITER
 		, TITLE
 		, CONTENT
 		, LOCATION_NO
 	)
 	VALUES
 	(
 		SEQ_FRIEND_NO.NEXTVAL
 		,#{writer}
 		,#{title}
 		,#{content}
 		,#{locationNo}
 	)
  </insert>
  
  <select id="FriendWrite" resultType="FriendVo">
  	SELECT
  		F.FRIEND_NO
		, F.WRITER
		, F.TITLE
		, F.CONTENT
		, F.LOCATION_NO
		, L.LOCATION_NAME as locationName
		, M.NAME as writerName
	FROM FRIEND F
	LEFT JOIN LOCATION L ON (F.LOCATION_NO = L.LOCATION_NO)
	LEFT JOIN MEMBER M ON (F.WRITER = M.NO)
	WHERE F.DELETE_YN = 'N'
  </select>
  
  	<insert id="insertAttachment"> <!-- open은 맨앞에 , close는 맨뒤 , separator는 중간중간 /를 나타냄 -->
		INSERT ALL
			<foreach collection="list" item="x" separator=" ">
			    INTO ATTACHMENT
			    (
			    	FRIEND_ATTACH_NO
					, FRIEND_NO
					, ORIGIN_NAME
					, CHANGE_NAME	
			    ) 
			    VALUES 
			    (
			    	(SELECT GET_ATTACHMENT_SEQ FROM DUAL) 
			    	,SEQ_FRIEND_NO.CURRVAL 
			    	,#{x.originName} 
			    	, #{x.changeName}
			    )
			</foreach>
		SELECT 1 FROM DUAL
	</insert>	
  
</mapper>