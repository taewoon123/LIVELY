<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="job">
	<select id="getAttachment" resultType="FileVo">
		SELECT *
		FROM JOB_ATTACH
		WHERE JOB_ATTACH_NO = #{ano}
		AND DELETE_YN = 'N'
	</select>

	<insert id="insertAttachment">
		INSERT ALL
		<foreach collection="list" item="x" separator=" ">
			INTO JOB_ATTACH
			(
			JOB_ATTACH_NO
			, JOB_NO
			, ORIGIN_NAME
			, CHANGE_NAME
			)
			VALUES
			(
			(SELECT GET_ATTACHMENT_SEQ FROM DUAL)
			, SEQ_JOB_NO.CURRVAL
			, #{x.originName}
			, #{x.changeName}
			)
		</foreach>
		SELECT 1 FROM DUAL
	</insert>

	<select id="getAttachmentList" resultType="FileVo">
		SELECT
		JOB_ATTACH_NO
		, JOB_NO
		, ORIGIN_NAME
		, CHANGE_NAME
		, DELETE_YN
		FROM JOB_ATTACH
		WHERE JOB_NO = #{jobNo}
		AND DELETE_YN = 'N'
	</select>


	<insert id="write">
		INSERT INTO JOB
		(
		JOB_NO
		, TITLE
		, CONTENT
		, WRITER
		, JOB_CHOICE_CODE
		)
		VALUES
		(
		SEQ_JOB_NO.NEXTVAL
		, #{title}
		, #{content}
		, 1
		, 1
		)
	</insert>

	<select id="getJobList" resultType="jobVo">
		SELECT *
		FROM JOB
		WHERE DELETE_YN = 'N'
		ORDER BY JOB_NO DESC
	</select>

	<select id="getJobListCnt" resultType="int">
		SELECT COUNT(*)
		FROM JOB
		WHERE DELETE_YN = 'N'
	</select>

	<update id="increaseHit">
		UPDATE JOB
		SET VIEWS = VIEWS+1
		WHERE JOB_NO = #{no}
		AND DELETE_YN= 'N'
	</update>

	<select id="getJob" resultType="JobVo">
		SELECT J.JOB_NO AS NO,
		M.NAME AS WRITER,
		J.TITLE,
		J.CONTENT,
		J.ENROLL_DATE,
		J.EDIT_DATE,
		J.DELETE_YN,
		J.VIEWS,
		J.JOB_CHOICE_CODE
		FROM JOB J
		JOIN MEMBER M ON M.NO = J.WRITER
		WHERE DELETE_YN = 'N'
		AND JOB_NO = #{no}
	</select>

	<update id="edit">
		UPDATE JOB
		SET
		TITLE = #{title}
		,CONTENT = #{content}
		,EDIT_DATE = SYSDATE
		WHERE JOB_NO = #{no}
	</update>

	<update id="delete">
	UPDATE  JOB
		SET
		DELETE_YN = 'Y'
		,EDIT_DATE = SYSDATE
		WHERE JOB_NO = #{no}
	</update>

</mapper>
	